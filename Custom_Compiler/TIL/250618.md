## 목차
- [stick diagram](#stick-diagram)
  - [⭐중복 path⭐](#중복-path)
    - [요약](#요약)
- [MOS Capacitance(Vgd)](#mos-capacitancevgd)
  - [추가 이해그림](#추가-이해그림)
- [MOSFET 동작 영역](#mosfet-동작-영역)
  - [⭐**각 영역에 따른 IDS 수식 반드시 암기**](#각-영역에-따른-ids-수식-반드시-암기)
  - [1. Cutoff](#1-cutoff)
    - [Cut-off 영역을 확인하는 경우](#cut-off-영역을-확인하는-경우)
    - [IDS가 그래프에서 띄워진 이유](#ids가-그래프에서-띄워진-이유)
  - [2. Linear](#2-linear)
  - [3. Saturation](#3-saturation)
    - [Linear-Saturation: Vdsat](#linear-saturation-vdsat)
- [MOSFET Non-ideal effect⭐⭐⭐](#mosfet-non-ideal-effect)
  - [Channel Length Modulation](#channel-length-modulation)
  - [Body effect](#body-effect)
- [Beta ratio](#beta-ratio)
  - [Beta ratio란](#beta-ratio란)
  - [⭐⭐⭐Beta ratio가 1이어야하는 이유](#beta-ratio가-1이어야하는-이유)
  - [Beta ratio 조절 방법(Width)](#beta-ratio-조절-방법width)
- [Logic Gate Simulation](#logic-gate-simulation)
  - [NAND Vs NOR: PMOS Size](#nand-vs-nor-pmos-size)
    - [⭐⭐⭐Summary](#summary)
  - [⭐Simulation 시 Inverter처럼 하는 이유](#simulation-시-inverter처럼-하는-이유)
    - [예제: 2NAND](#예제-2nand)
- [Layout Width 설정(Beta ratio)](#layout-width-설정beta-ratio)
  - [Mobility: 2up = un](#mobility-2up--un)
  - [병렬-직렬에 따른 Width 설정: Driving 능력](#병렬-직렬에-따른-width-설정-driving-능력)
    - [병렬](#병렬)
    - [직렬](#직렬)
    - [예시](#예시)
- [Custom Compiler](#custom-compiler)
  - [Parastic Analyze](#parastic-analyze)
    - [1. Paramterize할 대상 설정](#1-paramterize할-대상-설정)
    - [2. Parameter 변수 설정](#2-parameter-변수-설정)
    - [3. Parameter Value 확인하기](#3-parameter-value-확인하기)
  - [Inverter 중앙값을 만족하는 W 찾기](#inverter-중앙값을-만족하는-w-찾기)
    - [1. 초기조건: 1um~2um](#1-초기조건-1um2um)
      - [시뮬레이션 옵션](#시뮬레이션-옵션)
      - [결과](#결과)
    - [2. 해상도를 높여서 시뮬레이션 실행](#2-해상도를-높여서-시뮬레이션-실행)
      - [시뮬레이션 옵션](#시뮬레이션-옵션-1)
      - [결과](#결과-1)
    - [회로 수정](#회로-수정)
  - [CMOS 2NAND Simulation](#cmos-2nand-simulation)
    - [Schematic](#schematic)
      - [초기세팅](#초기세팅)
      - [참고](#참고)
    - [Symbol](#symbol)
    - [Test Setting](#test-setting)
    - [전압 세팅](#전압-세팅)
- [⭐Layout 시뮬레이션 방법(== Inverter)](#layout-시뮬레이션-방법-inverter)
- [단축키](#단축키)

# stick diagram

## ⭐중복 path⭐
- 병렬 2쌍 까지는 one-path 완성됨
- 병렬 2쌍에 직렬 path 여러개 까지는 출력단 diffusion path가 커지는 한이 있어도 one-path를 완성할 수 있음
  - 근데 병렬 1쌍이 여러개 물려있는 경우는 K-map으로 최적화 안된 경우
    - 그래서 logic block대로 그리는 것이 좋음
- 그러나 병렬 3쌍 이상부터는 one-path를 만들 수 없음
- 그래서 병렬 2쌍 씩 끊어서 stick diagram을 그려야 
함

### 요약
- 병렬 2쌍 이하로는 one-path 가능
- 그 이상의 병렬 쌍은 2쌍씩 끊어서 stick diagram을 그려야함
<br>
<br>
<br>
> 실제 현업에서 Layout
- 실제 현업에서는 Path를 잡아 Layout하는 경우가 적음
- 이미 만들어진 standart cell을 base로 연결하여 설계하는 경우임
- standard cell을 설계하는 직무에서는 path를 잡는 경우 존재

# MOS Capacitance(Vgd)
![MOS Capacitance](../image/스크린샷%202025-06-18%20135947.png)<br>

- Depletion region에서 Capacitance가 제일 작다
  - Depletion region에 의한 Gate와 Drain간 거리가 멀어짐
  - Capacitace는 거리가 멀어짐
- Accumulation region과 Inversion region의 Capacitance는 비슷함(거의 같음)
  - 위아래 전하만 달라짐

## 추가 이해그림
![MOS Capacitance](../image/스크린샷%202025-06-18%20175621.png)<br>

# MOSFET 동작 영역
> 참고) A: 옴스트롱 단위
> > 10^(-10)**m**
<br>

## ⭐**각 영역에 따른 IDS 수식 반드시 암기**

## 1. Cutoff
![Cut off region](../image/스크린샷%202025-06-18%20180113.png)<br>
- Vgs가 Vth보다 작은 경우
- 전류는 흐르지 않음
  - 사실 hot carrier등에 의해 미세하게 전류가 흐르긴함
  - 그 단위는 uA이하임
  - 전류가 흐른다고 판단하는 기준은 mA부터
- Switch Off 상태


### Cut-off 영역을 확인하는 경우
- Vth를 확인할 때 주로 확인


### IDS가 그래프에서 띄워진 이유
- y축 로그 스케일로 표현
- nA, uA로 흐르는지 확인 위함
- mA이상으로 흘러야 Turn On으로 판단

## 2. Linear
![Linear_ids](../image/스크린샷%202025-06-18%20181354.png)<br>

![linear Ids](../image/스크린샷%202025-06-18%20110207.png)<br>

- Vgs > Vth
- Vds < Vgs - Vth
  - == Vgd > Vth
  - ⭐pinch off 영역이 생기지않아 선형적으로 전류 증가
- Vds에 따라 전류가 증가한다
  - 주로 Analog에서 다루는 영역
  - 증폭기로 사용


## 3. Saturation
![Saturation ids](../image/스크린샷%202025-06-18%20184808.png)<br>

![Saturation Ids](../image/스크린샷%202025-06-18%20110306.png)<br>

- Vgs > Vth
- == Vgd < Vth
- pinch off 영역 형성
  - gate와 drain간 전압 차가 줄어들면 drain 쪽 채널이 줄어듦
- ⭐pinch off 영역에 의해 전류가 Vds에 따른 전류가 더 이상 증가하지않고 포화함

### Linear-Saturation: Vdsat
![Vds saturation](../image/스크린샷%202025-06-18%20185822.png)<br>
- Vgs가 증가할수록 Vdsaturation이 증가한다
  - Vdsat = Vgs - Vth
  - pinch off 영역이 형성되는 조건


# MOSFET Non-ideal effect⭐⭐⭐

## Channel Length Modulation
![CLM](../image/스크린샷%202025-06-18%20190205.png)<br>
- Drain 쪽 전압이 증가할수록 Drain 쪽 Depletion region 영역 증가
- 늘어난 Depletion region만큼 Leff감소
- 실질적인 채널의 길이가 짧아진만큼 전류량 증가
- 그래서 그래프 상에서 Saturation 영역임에도 불가하고 전류가 포화되지 않고 조금씩 증가

## Body effect
![body effect](../image/스크린샷%202025-06-18%20190539.png)<br>
- Body에 기준 전압이 걸려있지 않은 경우
  - Body 전압에 의해 Vth가 바뀔 수 있음
- NMOS 기준
  - Body에 음전압이 걸린 경우
  - P-Substrate의 Depletion Region이 넓어짐
  - 전자를 끌어오기 더 힘들어짐
    - Gate에 전압을 더 걸어줘야 함
  - 그래서 Vth가 증가함

# Beta ratio
![beta ratio](../image/스크린샷%202025-06-18%20190935.png)<br>

## Beta ratio란
![beta ratio](../image/스크린샷%202025-06-18%20191452.png)<br>
- NMOS와 PMOS의 channel length, width등의 비율을 의미
  - 이에 따라 PMOS, NMOS의 전류 driving 능력이 다름
- beta ratio가 1이어야 중앙값에서 inverting됨

## ⭐⭐⭐Beta ratio가 1이어야하는 이유
- 스위칭 임계전압이 Vdd/2로 만들기 위함
  - Ideal Inverter는 공급전압(Vdd)의 중간값에서 값이 변해야 함
- 대칭 rising(pmos)/ falling(nmos) time
  - PMOS와 NMOS의 driving 능력이 동일해야 상승 하강 시간이 동일하다
  - 만일 두 시간이 다르면, 타이밍 문제가 발생한다
- Noise margin을 최대로 만들기 위함
  - Vdd/2가 임계전압이어야 최대 노이즈 마진을 가진다
  - 예를 들어 공급전압이 1V인데 임계전압이 0.3V인 경우
    - 논리 0으로 인식하는 전압의 범위가 0~0.4V라 하면 0.3V일 떄 입력 0으로 인식해야하는데 1로 인식하는 문제 발생

## Beta ratio 조절 방법(Width)
- PMOS의 mobility가 NMOS의 mobility보다 1/2배 작음
- PMOS의 Width를 2배 늘려주어 PMOS driving 능력을 키워 NMOS와 맞춰줌
- 이러한 방식으로 beta ratio를 맞춤

# Logic Gate Simulation
## NAND Vs NOR: PMOS Size
- NAND
  - 입력이 늘수록 PMOS size줄어듦
- NOR
  - 입력이 늘수록 PMOS size늘어남
- ⭐NAND 계열로 설계하는 것이 전체 칩 면적에 대해 유리함!

### ⭐⭐⭐Summary
1. NAND Vs AND
- NAND 유리
  - inverter 추가 필요X

2. NAND VS NOR
- NAND 유리
  - 전체 칩 size면에서 유리
  - 입력이 늘수록 PMOS size 줄어듦

## ⭐Simulation 시 Inverter처럼 하는 이유

### 예제: 2NAND

|   A   |   B   |   Y   |
| :---: | :---: | :---: |
|   0   |   0   |   1   |
|   0   |   1   |   1   |
|   1   |   0   |   1   |
|   1   |   1   |   0   |

- 출력 Y가 1 -> 0 혹은 0 -> 1로 inverting되는 순간을 Simulation한다
  - Logic Simulation은 이미 RTL에서 확인하고 왔다고 가정
  - 그러면 **Beta ratio**가 맞는지가 중점
- 출력이 inverting되는 구간만 검증하여 Beta ratio를 확인한다
- 그래서 A를 1로 고정하고 B를 0에서 1로 step을 증가시키면서 시뮬레이션을 확인한다

# Layout Width 설정(Beta ratio)

## Mobility: 2up = un
- Hole의 모빌리티: up
- Electron 모빌리티: un
  - un = 2up (대략)
- 그래서 PMOS의 Width를 NMOS의 Width의 약 2배로 세팅해줌

## 병렬-직렬에 따른 Width 설정: Driving 능력

### 병렬
- 병렬 쌍에서 하나의 TR path만 고려하면 된다
  - 병렬이니 하나만 켜지면 되니까

### 직렬
- 직렬은 연결된 모든 TR에 대해 저항(R)을 고려해줘야 한다

### 예시
<img src = "../image/스크린샷%202025-06-19%20103934.png" width=50%, height=50%><br>
- 3NAND
- PMOS NMOS 모두 저항 R로 맞춰야 Pull-up Pull-down driving 능력을 맞춰줄 수 있다(Beta ratio)
- NMOS W당 저항 R이라 가정
  - NMOS는 3 직렬
    - 하나당 R/3으로 맞춰줘야함
    - 저항 1/3 --> Width 3배
    - NMOS Width: 3W
  - PMOS는 병렬
    - 하나의 TR만 고려
    - PMOS W --> 2R (mobility 차이에 의해서)
    - 저항 1/2 --> Width 2배
    - PMOS Width: 2W


# Custom Compiler

## Parastic Analyze

### 1. Paramterize할 대상 설정
![option1](../image/스크린샷%202025-06-18%20113505.png)<br>

![option1](../image/스크린샷%202025-06-18%20113607.png)<br>


- 하단에 (+)버튼을 누름

![option1](../image/스크린샷%202025-06-18%20113624.png)<br>

- 그럼 이렇게 schematic이 나옴

![option1](../image/스크린샷%202025-06-18%20113635.png)<br>

- Symbol을 더블 클릭해서 TR level로 들어감
- 그 후에 PMOS를 클릭하면 좌측처럼 Parameter화할 대상이 추가됨


### 2. Parameter 변수 설정
![option1](../image/스크린샷%202025-06-18%20113653.png)<br>

- PMOS의 WIDTH를 Parameter할 것임
- 그래서 W에 WIDTH를 넣음
  - 이 때, 반드시 **대문자**로 글자를 넣어야함
  - 안그러면 에러남

![option1](../image/스크린샷%202025-06-18%20113713.png)<br>

- 그러면 이렇게 내가 볼 신호 WIDTH가 추가됨

### 3. Parameter Value 확인하기
![option1](../image/스크린샷%202025-06-18%20113447.png)<br>

![option1](../image/스크린샷%202025-06-18%20113746.png)<br>

- 위의 옵션에 들어가서 Variable Name에 parameter할 WIDTH를 선택함

![option1](../image/스크린샷%202025-06-18%20113804.png)<br>

- 여기서 파라미터 시작값, 종료값, step size를 설정함

![option1](../image/스크린샷%202025-06-18%20113829.png)<br>

- 값을 세팅하고 나면, 우측에 시뮬레이션 세팅이 추가됨
  - 나중에 세팅을 변경하고 싶으면 "sweep WIDTH"를 더블 클릭하면 된다

## Inverter 중앙값을 만족하는 W 찾기

### 1. 초기조건: 1um~2um

#### 시뮬레이션 옵션
![option1](../image/스크린샷%202025-06-18%20113804.png)<br>

#### 결과
![option1](../image/스크린샷%202025-06-18%20114312.png)<br>

![option1](../image/스크린샷%202025-06-18%20114354.png)<br>

- 1.1um ~ 1.2um 사이에 width가 중앙값에 근접한다

### 2. 해상도를 높여서 시뮬레이션 실행

#### 시뮬레이션 옵션
![option1](../image/스크린샷%202025-06-18%20114116.png)<br>

#### 결과
![option1](../image/스크린샷%202025-06-18%20114519.png)<br>

![option1](../image/스크린샷%202025-06-18%20115504.png)<br>	

- 1.16um가 중앙값에 제일 근접한다

> ❗소수점 2자리로 해상도 정하는 이유❗
> > 그 이하의 소수점은 공정에서 불가능함

### 회로 수정
![option1](../image/스크린샷%202025-06-18%20121639.png)<br>

- 수정 내역
  - PMOS WIDTH: 1.16um 
  - NMOS WIDTH: 0.5um 

## CMOS 2NAND Simulation

### Schematic

![2NAND Schematic](../image/스크린샷%202025-06-18%20141633.png)<br>

#### 초기세팅
- PMOS Width: 1u
  - PMOS 저항: 1u --> R
- NMOS Width: 0.5u
  - NMOS 저항: 1개당 0.5u --> R/2
    - 직렬 저항 2개 --> R/2 * 2 = R

#### 참고

![다중 선택](../image/스크린샷%202025-06-18%20143258.png)<br>
- 위의 사진의 버튼을 누르면 여러 Cell을 선택해서 값을 바꿔줄 수 있다

### Symbol

<img src = "../image/스크린샷%202025-06-18%20143544.png" width=70% height=70%>

![symbol setting](../image/스크린샷%202025-06-18%20144941.png)<br>

### Test Setting
![Test Setting](../image/스크린샷%202025-06-18%20160241.png)<br>


### 전압 세팅
![voltage setting](../image/스크린샷%202025-06-18%20151150.png)<br>

|   A   |   B   |   Y   |
| :---: | :---: | :---: |
|   0   |   0   |   1   |
|   0   |   1   |   1   |
|   1   |   0   |   1   |
|   1   |   1   |   0   |
- AB : {1,0} --> {1,1}
  - 이 때, 출력 Y가 1 -> 0으로 바뀜
- 따라서 A = 1V로 fix
- B를 바꿔가면서 출력을 Simulation한다


# ⭐Layout 시뮬레이션 방법(== Inverter)

# 단축키
F3: 서브 창 잠금
  - 만약에 단축키로 서브창이 안눌리면 F3을 눌러보자
Shift-E: 심볼안으로 들어감
CTRL-E: 심볼 밖으로 나옴

