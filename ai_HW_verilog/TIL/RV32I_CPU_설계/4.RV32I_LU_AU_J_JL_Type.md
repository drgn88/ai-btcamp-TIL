# RV32I-LU/AU_JAL/JALR Type

## âš™ï¸Typeë³„ ì—­í• 

| Type  |                                                 Description                                                  |
| :---: | :----------------------------------------------------------------------------------------------------------: |
|  LU   |                               í° ê°’ì„ ë§Œë“¤ë•Œ ì‚¬ìš©<br>$imm*2^{12}$(== imm <<12)                               |
|  AU   |                             PCê°’ Offsetì´ êµ‰ì¥íˆ í´ ë•Œ ì‚¬ìš©<br>$PC + imm*2^{12}$                             |
|   J   |                     Return Addressë¥¼ ì €ì¥í•˜ê³ , ë¶„ê¸° ìœ„ì¹˜ë¡œ ì´ë™<br>PC ìƒëŒ€ ì£¼ì†Œ ì§€ì •ë°©ì‹                     |
|  JL   | Return Addressë¥¼ ì €ì¥í•˜ê³ , ë¶„ê¸° ìœ„ì¹˜ë¡œ ì´ë™<br>ë ˆì§€ìŠ¤í„° ê°„ì ‘ì£¼ì†Œ ì§€ì •ë°©ì‹<br>(Return Addressë¡œ ëŒì•„ê°ˆ ë•Œ ë“±) |

|                 **4-Type Base Instruction Code**                 |
| :--------------------------------------------------------------: |
| <img src="./img/RV32I_LU_AU_J_JL_Type/Base_Instruction_Set.png"> |

## ğŸ’»LU/AU_JAL/JALR-Type HW Architecture

|   TYPE   | Block Diagram                                                         |
| :------: | :-------------------------------------------------------------------- |
| LUI/AUI  | <img src="./img/RV32I_LU_AU_J_JL_Type/HW_Block_Diagram_LU_AU.png">    |
| JAL/JALR | <img src="./img/RV32I_LU_AU_J_JL_Type/HW_Block_Diagram_JAL_JALR.png"> |

LUI/AUI
---

### RFSrcMux
- ê° íƒ€ì…ì— ë”°ë¼ Register Fileì— Writeë˜ëŠ” Data(rd)ê°€ ë‹¬ë¼ì§
  - LU: imm << 12
  - AU: PC + (imm << 12)
  - JAL/JALR: PC + 4
- 4input Mux ì„¤ê³„
- Instruction opcodeì— ë”°ë¼ Mux Select signal ê²°ì •

### Imm_Extension
- LUI/AUI Typeì˜ Immediate ValueëŠ” í•˜ìœ„ 12ë¹„íŠ¸ë¥¼ zero padding ì‹œì¼œì¤˜ì•¼í•¨

[Code Description]
```verilog
module imm_extend(...);
	always_comb begin
	 case(opcode)
	 ...
		`OP_TYPE_LU:
            immExt = {
                instrCode[31:12], 12'b0
            };  //ì´ê±° ìì²´ê°€ shiftí•´ì¤€ê±°ì„
		`OP_TYPE_AU:
		immExt = {
			instrCode[31:12], 12'b0
		};  //ì´ê±° ìì²´ê°€ shiftí•´ì¤€ê±°ì„
	...
	 endcase
	end
endmodule
```

JAL/JALR
---

### PC_IMM_Adder_Src_Mux

- JALRì˜ ê²½ìš° PCì— (rs1+imm)ì´ ë“¤ì–´ê°
- Adderì—ì„œ PCì™€ ë”í•  ê°’ì¤‘ì— rs1ê³¼ immì¤‘ ì„ íƒ í•„ìš”
  - 2:1 Mux ì‚¬ìš©
- JALR Typeì¼ë•Œë§Œ rs1ì´ ì„ íƒë˜ë‹ˆ Control Unitì—ì„œ ```jalr``` signalì„ Mux select signalë¡œ ë³´ë‚´ì¤Œ

### OR Gate for PCSrcMux
- JAL-Typeì¼ ë•Œ, B-Typeê³¼ ë§ˆì°¬ê°€ì§€ë¡œ (PC+imm)ê°’ì´ ë‹¤ìŒ PCê°’ìœ¼ë¡œ ë“¤ì–´ê°
- B-Type ì¡°ê±´ì¼ ë•Œ **ë˜ëŠ”** JAL-Type ì¼ë•Œ PCSrcMuxì˜ Select Signalì´ 1ì´ ë“¤ì–´ê°€ì•¼í•¨
- Control Signalì—ì„œ ```opcode == JAL```ì¼ë•Œ ```jal``` signalì„ ë³´ë‚´ì£¼ê³  ì´ë¥¼ ê¸°ì¡´ branch AND Gateì™€ ORí•´ì£¼ì–´ Select Signalë¡œ ë³´ëƒ„

# ğŸ”Simulation ê²€ì¦

## âš™ï¸RegisterFile Setting

```verilog
//////////////////////////////////TESTìš©
    initial begin  // for simulation test
        for (int i = 0; i < 32; i++) begin
            mem[i] = 10 + i;
        end
    end
/////////////////////////////////
```

## âš™ï¸ROM Setting

```verilog
//////////////////////////////////TESTìš©
    //rom[x]=32'b imm20      _ rd  _ op // LU-Type
    rom[10] = 32'b00000000000000000001_00101_0110111;// lui x5, 0x10000
    //rom[x]=32'b imm20      _ rd  _ op // AU-Type
    rom[11] = 32'b00000000000000000001_00101_0010111;// auipc x5, 0x10000
	//rom[x]=32'b imm[20][10:1][11][19:12]      _ rd  _ op // J-Type
    // rom[4] = 32'b0_0000000110_0_00000000_00001_1101111;// jal x1, 12
    //rom[x]=32'b imm[11:0]_rs1 _000_ rd  _ op // JL-Type
    rom[4] = 32'b000000010000_00010_000_00001_1100111;// jalr x1, x2, 16
//////////////////////////////////
```

## âœ”ï¸Simulation Verification

### LUI

```verilog
//Machine Code
    //rom[x]=32'b imm20      _ rd  _ op // LU-Type
    rom[10] = 32'b10000000000000000000_00101_0110111;// lui x5, 0x10000
```

|  LUI   |                  Simulation Result                  |
| :----: | :-------------------------------------------------: |
| &nbsp; | <img src="./img/RV32I_LU_AU_J_JL_Type/luiê²€ì¦.png"> |

|  imm   |    32'h10000     |
| :----: | :--------------: |
| rd(x5) | 32'h10000**000** |

- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### AUI

```verilog
//Machine Code
    //rom[x]=32'b imm20      _ rd  _ op // AU-Type
    rom[11] = 32'b10000000000000000000_00101_0010111;// auipc x5, 0x10000
```

|  AUI   |                  Simulation Result                  |
| :----: | :-------------------------------------------------: |
| &nbsp; | <img src="./img/RV32I_LU_AU_J_JL_Type/AUIê²€ì¦.png"> |

| &nbsp; |     Value      |
| :----: | :------------: |
|  imm   | 32'd2147483648 |
|   PC   |     32'd44     |
| rd(x5) | 32'd2147483692 |

- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### JAL

```verilog
//Machine Code
    //rom[x]=32'b imm[20][10:1][11][19:12]      _ rd  _ op // J-Type
    rom[4] = 32'b0_0000000110_0_00000000_00001_1101111;// jal x1, 12
```

|  JAL   |                  Simulation Result                  |
| :----: | :-------------------------------------------------: |
| &nbsp; | <img src="./img/RV32I_LU_AU_J_JL_Type/jalê²€ì¦.png"> |

|  &nbsp;  |     Value      |
| :------: | :------------: |
|   imm    |     32'd12     |
| PC_After |     32'd28     |
|  rd(X1)  | 32'd20(==16+4) |

- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### JALR

```verilog
//Machine Code
    //rom[x]=32'b imm[11:0]_rs1 _000_ rd  _ op // JL-Type
    rom[4] = 32'b000000010000_00010_000_00001_1100111;// jalr x1, x2, 16
```

|  JALR  |                  Simulation Result                   |
| :----: | :--------------------------------------------------: |
| &nbsp; | <img src="./img/RV32I_LU_AU_J_JL_Type/jalrê²€ì¦.png"> |

|  &nbsp;  |            Value             |
| :------: | :--------------------------: |
|   imm    |            32'd16            |
| PC_After | 32'd28(== RD1(12) + imm(16)) |
|  rd(X1)  |        32'd20(==16+4)        |

- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

