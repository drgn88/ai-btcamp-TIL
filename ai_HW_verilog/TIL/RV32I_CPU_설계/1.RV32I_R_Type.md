# RV32I-R Type

## âš™ï¸R-Type ì—­í• 

- **ë²”ìš© ë ˆì§€ìŠ¤í„°** ê°„ ì—°ì‚°ì„ ìˆ˜í–‰í•œë‹¤
- R Type ì—°ì‚° ìˆ˜í–‰ê³¼ ê²°ê³¼ëŠ” **Register File**ì— í•œì •ë˜ì–´ ìˆ˜í–‰ëœë‹¤

|           **R-Type Base Instruction Code**           |
| :--------------------------------------------------: |
| <img src="./img/RV32I_R_Type/Base_Instr_Code_R.png"> |

- 10ê°€ì§€ ì—°ì‚° ì¡´ì¬

### ğŸ“Logical & Arithmetic ì—°ì‚°

|  &nbsp;  | **Arithmetic(Sign Extenstion)** | **Logical(Zero Padding)** |
| :------: | :-----------------------------: | :-----------------------: |
| **SLL**  |             &nbsp;              |             O             |
| **SRL**  |             &nbsp;              |             O             |
| **SRA**  |                O                |          &nbsp;           |
| **SLT**  |                O                |          &nbsp;           |
| **SLTU** |             &nbsp;              |             O             |

## ğŸ’»R-Type HW Architecture

|                **R-Type HW Architecture**                 |
| :-------------------------------------------------------: |
| <img src="./img/RV32I_R_Type/R_Type_HW_Architecture.png"> |

### ROM(Instruction Memory)
- PCë¡œë¶€í„° ë°›ì€ ì£¼ì†Œì— í•´ë‹¹í•˜ëŠ” ëª…ë ¹ì–´ë¥¼ CPUì— ì „ë‹¬í•œë‹¤
- opcode, function, register addressë“±ì˜ ì •ë³´ë¥¼ í¬í•¨í•œë‹¤

### Register File
- 32ê°œì˜ ë²”ìš© ë ˆì§€ìŠ¤í„°ë¥¼ ì €ì¥í•˜ëŠ” ë©”ëª¨ë¦¬
- â­**R0**ëŠ” í•­ìƒ 0ê°’ì„ ì €ì¥í•œë‹¤
  - RISC-V ê·œì•½
- Instruction codeë¡œë¶€í„° Register Addressë¥¼ ë°›ì•„, í•´ë‹¹í•˜ëŠ” ì£¼ì†Œì˜ dataë¥¼ ì¶œë ¥í•˜ê³ , ì €ì¥í•œë‹¤
  - Read Address & Write Address
- ë ˆì§€ìŠ¤í„° ê°„ ì—°ì‚°ì˜ ê²°ê³¼ë¥¼ Write Data í¬íŠ¸ë¥¼ í†µí•´ ì „ë‹¬ë°›ì•„ ë©”ëª¨ë¦¬ì— ì €ì¥í•œë‹¤

### ALU(Arithmetic Logical Unit)
- ì‚°ìˆ  ë° ë…¼ë¦¬ ì—°ì‚°ì„ ì²˜ë¦¬í•œë‹¤
- ê³„ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ì½”ì–´ ë¡œì§

### PC(Program Counter)
- ë‹¤ìŒ ìˆ˜í–‰í•  ëª…ë ¹ì–´ì˜ ì£¼ì†Œë¥¼ ì €ì¥í•˜ê³  ROMì—ê²Œ ì•Œë ¤ì£¼ëŠ” ì—­í• ì„ ìˆ˜í–‰
- í•œ ì‚¬ì´í´ë§ˆë‹¤ 4ì”© ì¦ê°€ì‹œì¼œ ì €ì¥
  - 32bit Processor == 4Byte
  - ë©”ëª¨ë¦¬ ì£¼ì†Œ ë‹¨ìœ„ê°€ 4ì”© ì¦ê°€(Offset == 4)

### Control Unit
- Instruction Codeë¥¼ ë°”íƒ•ìœ¼ë¡œ Data Pathì— ì ì ˆí•œ Control Signalì„ ë³´ë‚´ì¤€ë‹¤

# ğŸ”Simulation ê²€ì¦

## âš™ï¸RegisterFile Setting

```verilog
//////////////////////////////////TESTìš©
    initial begin
        for (int i = 0; i < 32; i++) begin
            mem[i] = 10 + i;
        end
        mem[15] = 32'b1111_0000_0000_0000_0000_0000_0000_0000;
    end
/////////////////////////////////
```

- Register Fileì˜ ê° ë©”ëª¨ë¦¬ì— ëŒ€í•´ (10+ë ˆì§€ìŠ¤í„°ë²ˆí˜¸)ë¥¼ ì´ˆê¸°ê°’ìœ¼ë¡œ ë„£ì–´ì¤Œ

## âš™ï¸ROM Setting

```verilog
//////////////////////////////////TESTìš©
    initial begin
        //rom[x] = 32'b func7 _ rs2 _ rs1 _ func3 _ rd _ op
        rom[0] = 32'b0000000_00001_00010_000_00100_0110011;    //add x4, x2, x1
        rom[1] = 32'b0100000_00001_00010_000_00101_0110011;    //sub x5, x2, x1
        rom[2] = 32'b0000000_00001_00100_001_00110_0110011;    //sll x6, x4, x1
        rom[3] = 32'b0000000_00011_00101_101_00111_0110011;    //srl x7, x5, x3
        rom[4] = 32'b0100000_00010_01111_101_01000_0110011;    //sra x8, x15, x2
        rom[5] = 32'b0000000_01000_00111_010_01001_0110011;    //slt x9, x7, x8
        rom[6] = 32'b0000000_01110_01111_011_01010_0110011;    //sltu x10, x13, x12
        rom[7] = 32'b0000000_00001_00100_100_01011_0110011;    //xor x11, x4, x1
        rom[8] = 32'b0000000_00011_00010_110_01100_0110011;    //or x12, x2, x3
        rom[9] = 32'b0000000_00111_00101_111_01101_0110011;    //and x13, x5, x7
    end
//////////////////////////////////
```

## âœ”ï¸Simulation Verification

### ADD

```verilog
//Machine Code
rom[0] = 32'b0000000_00001_00010_000_00100_0110011;    //add x4, x2, x1 //x4 = x2 + x1
```

|               add x4, x2, x1               |
| :----------------------------------------: |
| <img src="./img/RV32I_R_Type/addê²€ì¦.png"> |

- PC == 32'd0 (ROM[0]) ìˆ˜í–‰
- x4(23) = x2(12) + x1(11)
  - âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### SUB

```verilog
//Machine Code
rom[1] = 32'b0100000_00001_00010_000_00101_0110011;    //sub x5, x2, x1
```

|               sub x5, x2, x1               |
| :----------------------------------------: |
| <img src="./img/RV32I_R_Type/subê²€ì¦.png"> |

- PC == 32'd0 (ROM[0]) ìˆ˜í–‰
- x5(1) = x2(12) - x1(11)
  - âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### SLL

```verilog
//Machine Code
rom[2] = 32'b0000000_00001_00100_001_00110_0110011;    //sll x6, x4, x1
```

|               sll x6, x4, x1               |
| :----------------------------------------: |
| <img src="./img/RV32I_R_Type/sllê²€ì¦.png"> |


|     X4(rs1)     |   32'b0000_0000_0000_0000_0000_0000_0001_0111   |
| :-------------: | :---------------------------------------------: |
| X1(shift value) |                     32'd11                      |
|     X6(rd)      | 32'b0000_0000_0000_0000_1011_1**000_0000_0000** |

- âœ…11ë§Œí¼ ì™¼ìª½ìœ¼ë¡œ Shift ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### SRL

```verilog
//Machine Code
rom[3] = 32'b0000000_00011_00101_101_00111_0110011;    //srl x7, x5, x3
```

|               srl x7, x5, x3               |
| :----------------------------------------: |
| <img src="./img/RV32I_R_Type/srlê²€ì¦.png"> |


|     X5(rs1)     | 32'0000_0000_0000_0000_0000_0000_0000_0001  |
| :-------------: | :-----------------------------------------: |
| X3(shift value) |                   32'd13                    |
|     X7(rd)      | 32'b0000_0000_0000_0000_0000_0000_0000_0000 |

- âœ…Right Shiftë¥¼ í•˜ì—¬ ê°’ì´ 0ì´ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### SRA

```verilog
//Machine Code
rom[4] = 32'b0100000_00010_01111_101_01000_0110011;    //sra x8, x15, x2 
```

|              sra x8, x15, x2               |
| :----------------------------------------: |
| <img src="./img/RV32I_R_Type/sraê²€ì¦.png"> |


|    X15(rs1)     |   32'1111_0000_0000_0000_0000_0000_0000_0000    |
| :-------------: | :---------------------------------------------: |
| X2(shift value) |                     32'd12                      |
|     X8(rd)      | 32'b**1111_1111_1111**_1111_0000_0000_0000_0000 |

- âœ…Arithmetic Shift ì—°ì‚°ì— ë§ê²Œ MSBë¥¼ í™•ì¥í•˜ë©´ì„œ(**Sign Extension**) Shiftë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ í™•ì¸

### SLT

```verilog
//Machine Code
rom[5] = 32'b0000000_01000_00111_010_01001_0110011;    //slt x9, x7, x8
```

|               slt x9, x7, x8               |
| :----------------------------------------: |
| <img src="./img/RV32I_R_Type/sltê²€ì¦.png"> |

- (Signed) Set Less Than
- X7: 0
- X8: -65536
- X7 < X8 => False
  - X9 <= 0
- âœ…ì •ìƒ ì—°ì‚° 

### SLTU

```verilog
//Machine Code
rom[6] = 32'b0000000_01110_01111_011_01010_0110011;    //sltu x10, x13, x12
```

|             sltu x10, x13, x12              |
| :-----------------------------------------: |
| <img src="./img/RV32I_R_Type/sltuê²€ì¦.png"> |

- X13: 23
- X12: 22
- X13 < X12 => False
- X10 = 0
- âœ…ì •ìƒ  ì—°ì‚°

### XOR

```verilog
//Machine Code
rom[7] = 32'b0000000_00001_00100_100_01011_0110011;    //xor x11, x4, x1
```

|              xor x11, x4, x1               |
| :----------------------------------------: |
| <img src="./img/RV32I_R_Type/xorê²€ì¦.png"> |


| X4(rs1) | 32'b0000_0000_0000_0000_0000_0000_000**1_0111** |
| :-----: | :---------------------------------------------: |
| X1(rs2) | 32'b0000_0000_0000_0000_0000_0000_000**0_1011** |
| X8(rd)  | 32'b0000_0000_0000_0000_0000_0000_000**1_1100** |

- âœ…XOR ì—°ì‚° ì •ìƒ ìˆ˜í–‰

### OR

```verilog
//Machine Code
rom[8] = 32'b0000000_00011_00010_110_01100_0110011;    //or x12, x2, x3
```

|              or x12, x2, x3               |
| :---------------------------------------: |
| <img src="./img/RV32I_R_Type/orê²€ì¦.png"> |

| X2(rs1) | 32'b0000_0000_0000_0000_0000_0000_0000_**1100** |
| :-----: | :---------------------------------------------: |
| X3(rs2) | 32'b0000_0000_0000_0000_0000_0000_0000_**1101** |
| X12(rd) | 32'b00000_000_0000_0000_0000_0000_0000_**1101** |

- âœ…OR ì—°ì‚° ì •ìƒ ìˆ˜í–‰

### AND

```verilog
//Machine Code
rom[9] = 32'b0000000_00111_00101_111_01101_0110011;    //and x13, x5, x7
```

|              and x13, x5, x7               |
| :----------------------------------------: |
| <img src="./img/RV32I_R_Type/andê²€ì¦.png"> |

| X5(rs1) | 32'b0000_0000_0000_0000_0000_0000_0000_**0001** |
| :-----: | :---------------------------------------------: |
| X7(rs2) | 32'b0000_0000_0000_0000_0000_0000_0000_**0000** |
| X13(rd) | 32'b0000_0000_0000_0000_0000_0000_0000_**0000** |

- âœ…AND ì—°ì‚° ì •ìƒ ìˆ˜í–‰

