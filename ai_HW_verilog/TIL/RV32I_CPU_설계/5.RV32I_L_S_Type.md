# RV32I-L/S Type

## âš™ï¸L/S-Type ì—­í• 

|  Type  |                    Description                     |
| :----: | :------------------------------------------------: |
| L-Type | Data Memoryë¡œë¶€í„° ê°’ì„ ì½ì–´ì™€ Register Fileì— ì €ì¥ |
| S-Type |             Data Memoryì— ê°’ì„ ì €ì¥í•¨              |

> â­L/S Typeì˜ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´, Data Memory(**RAM**)ì´ ì¶”ê°€ë¡œ í•„ìš”í•˜ë‹¤

|    TYPE    |                       Block Diagram                       |
| :--------: | :-------------------------------------------------------: |
| **L-Type** | <img src="./img/RV32I_L_S_Type/L_TYPE_Block_Diagram.png"> |
| **S-Type** | <img src="./img/RV32I_L_S_Type/S_TYPE_Block_Diagram.png"> |

**L-Type**
---

### **Load_Value_Decision**

- Load Typeì— ë”°ë¼ ë©”ëª¨ë¦¬ì—ì„œ ê°€ì ¸ì˜¤ëŠ” ë°ì´í„° ì‚¬ì´ì¦ˆê°€ ë‹¤ë¦„
- â—íŠ¹íˆ, Load Byteì˜ ê²½ìš° ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ ì£¼ì†Œë¥¼ ì ‘ê·¼í•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— ì´ë¥¼ ê³ ë ¤í•´ì•¼í•¨
  - RAMì€ 32bit Processorì„ì„ ê°€ì •í•˜ê³  ì£¼ì†Œ ì ‘ê·¼ì‹œ 2bit offsetì„ ì£¼ì—ˆìŒ
  - Byte ë‹¨ìœ„ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•´ ì´ì œ ì£¼ì†Œì˜ í•˜ìœ„ 2ë¹„íŠ¸ê°’ë„ ê³ ë ¤í•´ì•¼í•¨
  - Control Unitì—ì„œ L_modeë¥¼ í†µí•´ Loadí•  ë°ì´í„° ì‚¬ì´ì¦ˆ(B, HW, W)ë¥¼ ì•Œë ¤ì¤Œ
- **LB**
  - Byte ë‹¨ìœ„ë¡œ ì ‘ê·¼í•˜ê¸°ìœ„í•´ addr[1:0] í•˜ìœ„ 2ë¹„íŠ¸ì— ë”°ë¼ Loadí•  ë°ì´í„° ë²”ìœ„ë¥¼ ì„ íƒí•¨
```verilog
case (addr[1:0])
	2'b00:
	load_value = {{{24{ram_read_data[7]}}}, ram_read_data[7:0]};
	2'b01:
	load_value = {
		{{24{ram_read_data[15]}}}, ram_read_data[15:8]
	};
	2'b10:
	load_value = {
		{{24{ram_read_data[23]}}}, ram_read_data[23:16]
	};
	2'b11:
	load_value = {
		{{24{ram_read_data[31]}}}, ram_read_data[31:24]
	};
endcase
```
- **LH**
  - Half World ë‹¨ìœ„ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•´ addr[1]ë¹„íŠ¸ì— ë”°ë¼ Loadí•  ë°ì´í„° ë²”ìœ„ë¥¼ ì„ íƒí•¨
    - âš ï¸RAM ê²½ê³„ë¥¼ ê±´ë“œë¦¬ëŠ” ê²ƒì„ ê³ ë ¤í•´ì•¼í•˜ëŠ”ë°, ì´ë•Œ, í•­ìƒ ìƒìœ„ 16ë¹„íŠ¸ í˜¹ì€ í•˜ìœ„ 16ë¹„íŠ¸ë§Œì„ ì ‘ê·¼í•œë‹¤ê³  ê°€ì •
```verilog
case (addr[1])
	1'b0:
	load_value = {
		{{16{ram_read_data[15]}}}, ram_read_data[15:0]
	};
	1'b1:
	load_value = {
		{{16{ram_read_data[31]}}}, ram_read_data[31:16]
	};
endcase
```
- **LW**
  - wordì˜ ê²½ìš°, ë“¤ì–´ì˜¤ëŠ” RAM_Read_Dataë¥¼ ê·¸ëŒ€ë¡œ ë‚´ë³´ë‚¸ë‹¤
```verilog
`LW: load_value = ram_read_data;
```
- **Unsigned**
  - Signed Caseì—ì„œ í™•ì¥í• ë•Œ, Zero Paddingí•˜ëŠ” ê²ƒë§Œ ë°”ê¿”ì£¼ë©´ ëœë‹¤

### **RFSrcMux**
- RAMì—ì„œ Read Dataê°€ ì¶”ê°€ë¡œ WDì— ë“¤ì–´ì˜¤ëŠ” Signal ì¤‘ í•˜ë‚˜ê°€ ë¨
- ê¸°ì¡´ 4:1 Muxì—ì„œ 5:1 Muxë¡œ ëŠ˜ë ¤ì•¼í•¨

**S-Type**
---

### **Store_Value_Decision**

- Store Typeì— ë”°ë¼ RAMì— ì €ì¥í•  ë°ì´í„°ì˜ ì‚¬ì´ì¦ˆê°€ ë‹¤ë¦„
- Loadì™€ ë§ˆì°¬ê°€ì§€ë¡œ Byte ë‹¨ìœ„ ì£¼ì†Œ ì ‘ê·¼ì„ ìœ„í•´ì„œ addressì˜ í•˜ìœ„ 2ë¹„íŠ¸ë„ ê³ ë ¤í•´ì¤˜ì•¼í•¨
- Control Unitì—ì„œ **S_mode** ì‹ í˜¸ë¥¼ ë³´ë‚´ì£¼ì–´ RAMì— ì €ì¥í•  ë°ì´í„°ì˜ ë²”ìœ„ë¥¼ ì•Œë ¤ì¤Œ
- â­RAM ìˆ˜ì •ì„ ë°°ì œí•˜ê¸° ìœ„í•´, RAMì— ì €ì¥í•  ì£¼ì†Œì˜ Dataë¥¼ ì½ì–´ì„œ DataPathì—ì„œ Storeí•  ë¶€ë¶„ë§Œ ë°”ê¿”ì£¼ì–´ RAMì— ë„£ì–´ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ ì„¤ê³„í•¨
- **SB**
  - Addressì˜ í•˜ìœ„ 2ë¹„íŠ¸ë¥¼ ë³´ê³ , RAMì— ì €ì¥í•  32ë¹„íŠ¸ì—ì„œ storeí•  ë¹„íŠ¸ë²”ìœ„ì— ê°’ë§Œ ë°”ê¿”ì£¼ë„ë¡ ì„¤ê³„
```verilog
store_value = 32'bz;
case (addr[1:0])
	2'b00:
	store_value = {ram_read_data[31:8], reg_file_data[7:0]};    
	2'b01:
	store_value = {
		ram_read_data[31:16],
		reg_file_data[15:8],
		ram_read_data[7:0]
	};
	2'b10:
	store_value = {
		ram_read_data[31:24],
		reg_file_data[23:16],
		ram_read_data[15:0]
	};
	2'b11:
	store_value = {reg_file_data[31:24], ram_read_data[23:0]};
endcase
```
- **SH**
  - addr[1]ë¹„íŠ¸ë¥¼ ë³´ê³ , RAMì— ì €ì¥í•  32ë¹„íŠ¸ì—ì„œ storeí•  ë¹„íŠ¸ ë²”ìœ„ì˜ ê°’ë§Œ ë°”ê¿ˆ
    - addr[1] == 1 : ìƒìœ„ 16ë¹„íŠ¸
    - addr[1] == 0 : í•˜ìœ„ 16ë¹„íŠ¸
```verilog
case (addr[1])
	1'b0:
	store_value = {ram_read_data[31:16], reg_file_data[15:0]};
	1'b1:
	store_value = {reg_file_data[31:16], ram_read_data[15:0]};
endcase
```
- **SW**
  - Register Fileì—ì„œ ì½ì€ 32bit ê·¸ëŒ€ë¡œ RAMì— ì €ì¥í•˜ë©´ ë¨
```verilog
`SW: store_value = reg_file_data;
```

# ğŸ”Simulation ê²€ì¦

## âš™ï¸RegisterFile Setting

```verilog
//////////////////////////////////TESTìš©
    initial begin  // for simulation test
        for (int i = 0; i < 32; i++) begin
            mem[i] = 10 + i;
        end
		mem[31] = 32'h3322_11ff;
        mem[1] = 32'h0000_0004;
    end
/////////////////////////////////
```

## âš™ï¸ROM Setting

```verilog
	/*********** Byte ***********/
	//rom[x]=32'b imm12      _ rs1 _f3 _ rd  _ op // L-Type
    rom[12] = 32'b000000000000_00000_000_01111_0000011;// lb x15, 0(x0)
    rom[13] = 32'b000000000001_00000_000_10000_0000011;// lb x16, 1(x0)
    rom[14] = 32'b000000000010_00000_000_10001_0000011;// lb x17, 2(x0)
    rom[15] = 32'b000000000011_00000_000_10010_0000011;// lb x18, 3(x0)
    //rom[x]=32'b imm7  _ rs2 _ rs1 _f3 _ imm5_ op // S-Type
    rom[16] = 32'b0000000_11111_00001_000_00000_0100011;// sb x31, 0(x1)
    rom[17] = 32'b0000000_11111_00001_000_00001_0100011;// sb x31, 1(x1)
    rom[18] = 32'b0000000_11111_00001_000_00010_0100011;// sb x31, 2(x1)
    rom[19] = 32'b0000000_11111_00001_000_00011_0100011;// sb x31, 3(x1)
	
    /*********** Half Word ***********/
	//rom[x]=32'b imm12      _ rs1 _f3 _ rd  _ op // L-Type
    rom[20] = 32'b000000000000_00000_001_10011_0000011;// lh x19, 0(x0)
    rom[21] = 32'b000000000010_00000_001_10100_0000011;// lh x20, 2(x0)
    //rom[x]=32'b imm7  _ rs2 _ rs1 _f3 _ imm5_ op // S-Type
    rom[22] = 32'b0000000_11111_00001_001_00000_0100011;// sh x31, 0(x1)
    rom[23] = 32'b0000010_11111_00001_001_00001_0100011;// sh x31, 2(x1)

	/*********** Word ***********/
	//rom[x]=32'b imm12      _ rs1 _f3 _ rd  _ op // L-Type
    rom[6] = 32'b000000001000_00000_010_01000_0000011;// lw x8, 8(x0)
	//rom[x]=32'b imm7  _ rs2 _ rs1 _f3 _ imm5_ op // S-Type
    rom[4] = 32'b0000000_11111_00000_010_00000_0100011;// sw x31, 0(x0)
```

## âœ”ï¸Simulation Verification

### LB

```verilog
	/*********** Byte ***********/
	//rom[x]=32'b imm12      _ rs1 _f3 _ rd  _ op // L-Type
    rom[12] = 32'b000000000000_00000_000_01111_0000011;// lb x15, 0(x0)
    rom[13] = 32'b000000000001_00000_000_10000_0000011;// lb x16, 1(x0)
    rom[14] = 32'b000000000010_00000_000_10001_0000011;// lb x17, 2(x0)
    rom[15] = 32'b000000000011_00000_000_10010_0000011;// lb x18, 3(x0)
```

| Operate |              Simulation Result              |
| :-----: | :-----------------------------------------: |
| **LB**  | <img src="./img/RV32I_L_S_Type/lbê²€ì¦.png"> |

|  PC   |  RAM(Load Data)   |        X15        |        X16        |        X17        |        X18        |
| :---: | :---------------: | :---------------: | :---------------: | :---------------: | :---------------: |
|  48   | 32'h3322_11**ff** | 32'hffff_ff**ff** |      &nbsp;       |      &nbsp;       |      &nbsp;       |
|  52   | 32'h3322_**11**ff |      &nbsp;       | 32'h0000_00**11** |      &nbsp;       |      &nbsp;       |
|  56   | 32'h33**22**_11ff |      &nbsp;       |      &nbsp;       | 32'h0000_00**22** |      &nbsp;       |
|  60   | 32'h**33**22_11ff |      &nbsp;       |      &nbsp;       |      &nbsp;       | 32'h0000_00**33** |

- í•´ë‹¹í•˜ëŠ” ì£¼ì†Œ(1Byte ë‹¨ìœ„)ì— ì ‘ê·¼í•˜ì—¬ ê°’ì„ ì •ìƒì ìœ¼ë¡œ Register Fileì— ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í™•ì¸ ê°€ëŠ¥
- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### SB

```verilog
	/*********** Byte ***********/
	//rom[x]=32'b imm7  _ rs2 _ rs1 _f3 _ imm5_ op // S-Type
    rom[16] = 32'b0000000_11111_00001_000_00000_0100011;// sb x31, 0(x1)
    rom[17] = 32'b0000000_11111_00001_000_00001_0100011;// sb x31, 1(x1)
    rom[18] = 32'b0000000_11111_00001_000_00010_0100011;// sb x31, 2(x1)
    rom[19] = 32'b0000000_11111_00001_000_00011_0100011;// sb x31, 3(x1)
```

| Operate |              Simulation Result              |
| :-----: | :-----------------------------------------: |
| **SB**  | <img src="./img/RV32I_L_S_Type/sbê²€ì¦.png"> |

|      X31      |   RAM_0ë²ˆì§€   |   RAM_1ë²ˆì§€   |   RAM_2ë²ˆì§€   |   RAM_3ë²ˆì§€   |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| 32'b3322_11ff | 32'bXXXX_XXff | 32'bXXXX_11ff | 32'bXX22_11ff | 32'b3322_11ff |

- RAMì˜ 0ë²ˆì§€ë¶€í„° 3ë²ˆì§€ê¹Œì§€ Byteë‹¨ìœ„ë¡œ ê°’ì´ ì €ì¥ë˜ëŠ” ê²ƒì„ í™•ì¸ ê°€ëŠ¥
- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### LH

```verilog
	/*********** Half Word ***********/
	//rom[x]=32'b imm12      _ rs1 _f3 _ rd  _ op // L-Type
    rom[20] = 32'b000000000000_00000_001_10011_0000011;// lh x19, 0(x0)
    rom[21] = 32'b000000000010_00000_001_10100_0000011;// lh x20, 2(x0)
```

| Operate |              Simulation Result              |
| :-----: | :-----------------------------------------: |
| **LH**  | <img src="./img/RV32I_L_S_Type/lhê²€ì¦.png"> |

|    RAM[0]     |        X19        |        X20        |
| :-----------: | :---------------: | :---------------: |
| 32'h3322_11ff | 32'h0000_**11ff** | 32'h0000_**3322** |

- RAM[0]ì˜ 32ë¹„íŠ¸ ë°ì´í„°ì—ì„œ ìƒìœ„ 16ë¹„íŠ¸, í•˜ìœ„ 16ë¹„íŠ¸ê°€ ë ˆì§€ìŠ¤í„° íŒŒì¼ë¡œ ì •ìƒì ìœ¼ë¡œ Loadë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### SH

```verilog
	/*********** Half Word ***********/
	//rom[x]=32'b imm7  _ rs2 _ rs1 _f3 _ imm5_ op // S-Type
    rom[22] = 32'b0000000_11111_00001_001_00000_0100011;// sh x31, 0(x1)
    rom[23] = 32'b0000010_11111_00001_001_00001_0100011;// sh x31, 2(x1)
```

| Operate |              Simulation Result              |
| :-----: | :-----------------------------------------: |
| **SH**  | <img src="./img/RV32I_L_S_Type/shê²€ì¦.png"> |

|      X31      |   RAM[2][15:0]    |   RAM[2][31:16]   |
| :-----------: | :---------------: | :---------------: |
| 32'h3322_11ff | 32'hXXXX_**11ff** | 32'h3322_**11ff** |

- Register Fileì—ì„œ ë‚˜ì˜¨ ì €ì¥í•  Dataê°€ RAM[2](ì‹¤ì£¼ì†Œ 4ë²ˆì§€)ì— ê°ê° í•˜ìœ„ 16ë¹„íŠ¸, ìƒìœ„ 16ë¹„íŠ¸ì— ìˆœì°¨ì ìœ¼ë¡œ ì €ì¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### LW

```verilog
	/*********** Word ***********/
	//rom[x]=32'b imm12      _ rs1 _f3 _ rd  _ op // L-Type
    rom[6] = 32'b000000001000_00000_010_01000_0000011;// lw x8, 8(x0)
```

| Operate |              Simulation Result              |
| :-----: | :-----------------------------------------: |
| **LW**  | <img src="./img/RV32I_L_S_Type/lwê²€ì¦.png"> |

|    RAM[2]     |      X8       |
| :-----------: | :-----------: |
| 32'h0000_000d | 32'h0000_000d |

- RAM[2]ì˜ Dataê°€ Register File(X8)ì— ì •ìƒì ìœ¼ë¡œ loadë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### SW

```verilog
	/*********** Word ***********/
	//rom[x]=32'b imm7  _ rs2 _ rs1 _f3 _ imm5_ op // S-Type
    rom[4] = 32'b0000000_11111_00000_010_00000_0100011;// sw x31, 0(x0)
```

| Operate |              Simulation Result              |
| :-----: | :-----------------------------------------: |
| **SW**  | <img src="./img/RV32I_L_S_Type/swê²€ì¦.png"> |

|      X31      |    RAM[0]     |
| :-----------: | :-----------: |
| 32'h3322_11ff | 32'h3322_11ff |

- Register File(X31)ì˜ ë°ì´í„°ê°€ RAM[0]ì— ì •ìƒì ìœ¼ë¡œ Storeë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

