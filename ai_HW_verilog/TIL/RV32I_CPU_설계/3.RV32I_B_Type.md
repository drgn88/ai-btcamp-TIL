# RV32I-B Type

## âš™ï¸B-Type ì—­í• 

- **ë¹„êµ**ë¥¼ í†µí•´ ë¶„ê¸°í•  ë‹¤ìŒ ëª…ë ¹ì–´ì˜ ì£¼ì†Œë¥¼ ê²°ì •í•œë‹¤
- â­ë¹„êµê¸°ì™€ PC ê¹‚ ì—°ì‚°ì´ í•µì‹¬

|           **B-Type Base Instruction Code**            |
| :---------------------------------------------------: |
| <img src="./img/RV32I_B_Type/B_Type_Instruction.png"> |


## ğŸ’»B-Type HW Architecture

|                **B-Type HW Architecture**                 |
| :-------------------------------------------------------: |
| <img src="./img/RV32I_B_Type/B_Type_HW_Architecture.png"> |

### Comparator in ALU

- Branch
  - **ì¡°ê±´ ë¹„êµ**ë¥¼ í†µí•œ ë¶„ê¸°
  - ë¹„êµ ì—°ì‚°ê¸° í•„ìš”
- ì‚°ìˆ  & ë¡œì§ ì—°ì‚°ì„ í•˜ëŠ” ALUì— í•´ë‹¹ ê¸°ëŠ¥ ì¶”ê°€
- ğŸ“¶Signal: **btaken**
  - ì¡°ê±´ë¹„êµì˜ ê²°ê³¼(ë¹„êµê¸° ê²°ê³¼)ì— ë”°ë¼ PCê°’ì´ ë°”ë€œ
  - ë¹„êµê¸° ê²°ê³¼ë¥¼ ì•Œë ¤ì£¼ëŠ” ì‹ í˜¸ í•„ìš”

[Code Description]
```verilog
module alu(... , output logic btaken);

...

	always_comb begin : branch
        btaken = 1'b0;
        case (aluControl[2:0])
            `BEQ:  btaken = (a == b);
            `BNE:  btaken = (a != b);
            `BLT:  btaken = ($signed(a) < $signed(b));
            `BGE:  btaken = ($signed(a) >= $signed(b));
            `BLTU: btaken = (a < b);
            `BGEU: btaken = (a >= b);
        endcase
    end

...

endmodule
```

### Branch signal in Control Unit

- í˜„ì¬ instruction typeì´ branchì¸ì§€ ì•Œë ¤ì£¼ëŠ” ì‹ í˜¸
  - B-Typeê³¼ R-Typeì˜ func3ë¶€ë¶„ì´ ê²¹ì¹¨
  - B-Typeì´ ì•„ë‹ë•Œë„ ```btaken``` ì‹ í˜¸ê°€ ì¶œë ¥ë¨
- PCì˜ ê°’ì„ ê²°ì •í• ë•Œ, ```btaken``` ì‹ í˜¸ë§Œ ê°€ì§€ê³  ê²°ì •í•˜ë©´ ìœ„í—˜í•¨
- branch ì‹ í˜¸ë¥¼ ì´ìš©í•´ì„œ PCì˜ ê°’ì„ ê²°ì •í•´ì¤Œ

### PCSrcMux

- ì¡°ê±´ ê²°ê³¼ì— ë”°ë¼ ë‹¤ìŒ ì‹¤í–‰ë  ëª…ë ¹ì–´ì˜ ì£¼ì†Œ(PC)ê°€ ë‹¬ë¼ì§
  - ì¡°ê±´ ê²°ê³¼ False: ë‹¤ìŒ PCì˜ ê°’ == PC + 4
  - ì¡°ê±´ ê²°ê³¼ True: ë‹¤ìŒ PCì˜ ê°’ == PC + imm
- Select Signal
  - branch ì—°ì‚°ì´ê³ , ì¡°ê±´ì´ ì°¸(btaken == 1)ì¼ ë•Œ, PC+immê°’ì´ ë‹¤ìŒ ëª…ë ¹ì–´ì˜ ì£¼ì†Œê°€ ë¨
  - ```branch``` ì™€ ```btaken```ì„ &ì—°ì‚°í•˜ì—¬ Select Signalë¡œ ë„£ì–´ì¤Œ

# ğŸ”Simulation ê²€ì¦

> ë¶„ê¸°ë¬¸ì„ ê²€ì¦í•˜ëŠ”ê²ƒì´ë¯€ë¡œ ROMì˜ ì£¼ì†Œê°€ 1ì”© ì¦ê°€í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ê³„ì† ë°”ë€œ
> > ê·¸ë˜ì„œ ROM[x] í•˜ë‚˜ì— ëŒ€í•´ B-Type ëª¨ë“  ì—°ì‚°ì„ ê²€ì¦í•¨<br>
>> ì¡°ê±´ì˜ ì°¸, ê±°ì§“ íŒë³„ êµ¬ë¶„ì„ ì‰½ê²Œ í•˜ê¸° ìœ„í•´ Register Fileì˜ ì´ˆê¸°ê°’ì€ ê²€ì¦ë§ˆë‹¤ ë°”ê¿”ì£¼ì—ˆìŒ

## âš™ï¸RegisterFile Setting

```verilog
//////////////////////////////////TESTìš©
	initial begin  // for simulation test
        for (int i = 0; i < 32; i++) begin
            mem[i] = 10 + i;
        end
        mem[28] = 32'b1111_0000_0000_0000_0000_0000_0000_0000;
    end
/////////////////////////////////
```

## âš™ï¸ROM Setting

> BEQì— ëŒ€í•œ ì˜ˆì‹œ, ì´ëŸ° ì‹ìœ¼ë¡œ ì°¸, ê±°ì§“ íŒë³„ ì§„í–‰ ì˜ˆì •
```verilog
//////////////////////////////////TESTìš©
    //rom[x]=32'b imm7  _ rs2 _ rs1 _f3 _ imm5_ op // B-Type
    rom[0] = 32'b0000000_00010_00010_000_01100_1100011;// beq x2, x2, 12
    rom[3] = 32'b0000000_00010_00011_000_01100_1100011;// beq x2, x3, 12
//////////////////////////////////
```

## âœ”ï¸Simulation Verification

### BEQ

```verilog
//Machine Code
	  rom[0] = 32'b0000000_00010_00010_000_01100_1100011;// beq x2, x2, 12
    rom[3] = 32'b0000000_00010_00011_000_01100_1100011;// beq x2, x3, 12
```

|  BEQ   |                  True Case                  |                  False Case                  |
| :----: | :-----------------------------------------: | :------------------------------------------: |
| &nbsp; | <img src="./img/RV32I_B_Type/beq_true.png"> | <img src="./img/RV32I_B_Type/beq_false.png"> |

| CASE  | PC Value |
| :---: | :------: |
| True  |  32'd12  |
| False |  32'd16  |

- rom[0]ì—ì„œëŠ” ê²°ê³¼ê°€ ì°¸ì´ë¯€ë¡œ, í˜„ì¬ PCê°’ì—ì„œ immê°’(12)ë¥¼ ë”í•œ ê°’ì´ ë‹¤ìŒ PCê°’ì´ ëœë‹¤
- rom[3]ì—ì„œëŠ” ê²°ê³¼ê°€ ê±°ì§“ì´ë¯€ë¡œ, í˜„ì¬ PCê°’ì—ì„œ 4ë¥¼ ë”í•œ ê°’ì´ ë‹¤ìŒ PCê°’ì´ ëœë‹¤
- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### BNE

```verilog
//Machine Code
    rom[0] = 32'b0000000_00011_00010_001_01100_1100011;// bne x2, x3, 12
    rom[3] = 32'b0000000_00010_00010_001_01100_1100011;// bne x2, x2, 12
```

|  BNE   |                  True Case                  |                  False Case                  |
| :----: | :-----------------------------------------: | :------------------------------------------: |
| &nbsp; | <img src="./img/RV32I_B_Type/bne_true.png"> | <img src="./img/RV32I_B_Type/bne_false.png"> |

| CASE  | PC Value |
| :---: | :------: |
| True  |  32'd12  |
| False |  32'd16  |

- rom[0]ì—ì„œëŠ” ê²°ê³¼ê°€ ì°¸ì´ë¯€ë¡œ, í˜„ì¬ PCê°’ì—ì„œ immê°’(12)ë¥¼ ë”í•œ ê°’ì´ ë‹¤ìŒ PCê°’ì´ ëœë‹¤
- rom[3]ì—ì„œëŠ” ê²°ê³¼ê°€ ê±°ì§“ì´ë¯€ë¡œ, í˜„ì¬ PCê°’ì—ì„œ 4ë¥¼ ë”í•œ ê°’ì´ ë‹¤ìŒ PCê°’ì´ ëœë‹¤
- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### BLT

```verilog
//Machine Code
    rom[0] = 32'b0000000_00011_00010_100_01100_1100011;// blt x2, x3, 12
    rom[3] = 32'b0000000_00010_00010_100_01100_1100011;// blt x2, x2, 12
```

|  BLT   |                  True Case                  |                  False Case                  |
| :----: | :-----------------------------------------: | :------------------------------------------: |
| &nbsp; | <img src="./img/RV32I_B_Type/blt_true.png"> | <img src="./img/RV32I_B_Type/blt_false.png"> |

| CASE  | PC Value |
| :---: | :------: |
| True  |  32'd12  |
| False |  32'd16  |

- rom[0]ì—ì„œëŠ” ê²°ê³¼ê°€ ì°¸ì´ë¯€ë¡œ, í˜„ì¬ PCê°’ì—ì„œ immê°’(12)ë¥¼ ë”í•œ ê°’ì´ ë‹¤ìŒ PCê°’ì´ ëœë‹¤
- rom[3]ì—ì„œëŠ” ê²°ê³¼ê°€ ê±°ì§“ì´ë¯€ë¡œ, í˜„ì¬ PCê°’ì—ì„œ 4ë¥¼ ë”í•œ ê°’ì´ ë‹¤ìŒ PCê°’ì´ ëœë‹¤
- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### BGE

```verilog
//Machine Code
    rom[0] = 32'b0000000_00010_00011_101_01100_1100011;// bge x3, x2, 12
    rom[3] = 32'b0000000_00010_00010_101_01100_1100011;// bge x2, x2, 12
    rom[6] = 32'b0000000_00010_00001_101_01100_1100011;// bge x1, x2, 12
```

|          BGE           |               Simulation result               |
| :--------------------: | :-------------------------------------------: |
| **True Case**(rom[0])  | <img src="./img/RV32I_B_Type/bge_true_1.png"> |
| **True Case**(rom[3])  | <img src="./img/RV32I_B_Type/bge_true_2.png"> |
| **False Case**(rom[6]) | <img src="./img/RV32I_B_Type/bge_false.png">  |

| CASE  | PC Value |
| :---: | :------: |
| True  |  32'd12  |
| True  |  32'd24  |
| False |  32'd26  |

- rom[0]ì—ì„œëŠ” ê²°ê³¼ê°€ ì°¸ì´ë¯€ë¡œ, í˜„ì¬ PCê°’ì—ì„œ immê°’(12)ë¥¼ ë”í•œ ê°’ì´ ë‹¤ìŒ PCê°’ì´ ëœë‹¤
- rom[3]ì—ì„œëŠ” ê²°ê³¼ê°€ ì°¸ì´ë¯€ë¡œ, í˜„ì¬ PCê°’ì—ì„œ immê°’(12)ë¥¼ ë”í•œ ê°’ì´ ë‹¤ìŒ PCê°’ì´ ëœë‹¤
- rom[6]ì—ì„œëŠ” ê²°ê³¼ê°€ ê±°ì§“ì´ë¯€ë¡œ, í˜„ì¬ PCê°’ì—ì„œ 4ë¥¼ ë”í•œ ê°’ì´ ë‹¤ìŒ PCê°’ì´ ëœë‹¤
- âœ…ì •ìƒìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤