## 목차
- [CNN Layer](#cnn-layer)
- [코드 분석](#코드-분석)
  - [1. Convolution](#1-convolution)
  - [2. MaxPooling 함수](#2-maxpooling-함수)
  - [3. Featuring 함수](#3-featuring-함수)
  - [전체 CNN Layer 순서](#전체-cnn-layer-순서)

# CNN Layer

# 코드 분석

## 1. Convolution
```python
# conv 함수: 합성곱 연산의 기본 단위
def conv(a, b):
  """
  두 배열을 요소별로 곱한 후 합계를 반환합니다.
  합성곱 연산의 한 단계에 해당합니다.
  """
  c = np.array(a) * np.array(b)
  return np.sum(c)
```

- a, b는 배열
- 두 배열을 요소별로 곱한 후 합계를 반환

## 2. MaxPooling 함수
```python
# MaxPooling 함수: 2x2 영역에서 최대값을 추출
def MaxPooling(nimg):
  """
  주어진 2D 배열에 대해 2x2 맥스 풀링을 수행합니다.
  입력 이미지의 크기가 홀수일 경우 패딩을 추가하여 처리합니다.
  """
  nimg = np.array(nimg)
  i0, j0 = nimg.shape

  # 출력 이미지의 크기 계산
  i1 = (i0 + 1) // 2
  j1 = (j0 + 1) // 2
  output = np.zeros((i1, j1))

  # 이미지 크기가 홀수일 경우 0으로 패딩 추가
  # 행 패딩
  if i0 % 2 == 1:
    nimg = np.concatenate([nimg, np.zeros((1, j0))], axis=0)
    i0 += 1 # 패딩 후 새로운 높이 업데이트
  
  # 열 패딩 (행 패딩이 먼저 적용되었으므로 j0를 사용)
  if j0 % 2 == 1:
    nimg = np.concatenate([nimg, np.zeros((i0, 1))], axis=1)
    j0 += 1 # 패딩 후 새로운 너비 업데이트

  for i in range(output.shape[0]):
    for j in range(output.shape[1]):
      # 2x2 영역에서 최대값 추출
      a = nimg[2*i : 2*i+2, 2*j : 2*j+2]
      output[i, j] = a.max()
    
  return output
```

- 2X2 영역에서 최대값 추출
- ```np.concatenate()```
  - 여러개의 numpy 배열을 지정 축을 따라 하나로 합치는 함수
  - 원본 이미지 배열에 행방향 혹은 열방향 0으로 채워진 배열을 추가함
    - == Padding

## 3. Featuring 함수
```python
# featuring 함수: 하나의 필터로 특징 맵 생성
def featuring(nimg, filters): # 2d input nimg, 3x3 filter
  """
  하나의 2D 이미지와 하나의 3x3 필터를 사용하여 특징 맵을 생성합니다.
  """
  # 필터는 항상 3x3으로 가정
  filter_h, filter_w = filters.shape
  
  # 출력 특징 맵의 크기 계산
  output_h = nimg.shape[0] - filter_h + 1
  output_w = nimg.shape[1] - filter_w + 1
  
  feature = np.zeros((output_h, output_w))
  
  for i in range(output_h):
    for j in range(output_w):
      # 필터 크기만큼의 이미지 영역 추출
      a = nimg[i : i + filter_h, j : j + filter_w]
      feature[i, j] = conv(a, filters)
      
  return feature
```

- 필터를 통해 nimg라는 이미지를 처리하여 feature map을 생성함

## 전체 CNN Layer 순서

```python
# CNN Layer: 합성곱, ReLU, 풀링 과정
def ConvMax(nimg, filters_list): # 2d input nimg, list of filters
  """
  하나의 CNN 레이어(합성곱, ReLU 활성화, 맥스 풀링)를 수행합니다.
  """
  nimg = np.array(nimg)
  f0 = ConvD(nimg, filters_list) # 필터 리스트 전달
  f0_relu = ReLU(f0) # ReLU 적용된 특징 맵
  fg = Pooling(f0_relu) # ReLU 적용된 특징 맵에 풀링 적용
  return f0_relu, fg # f0_relu 반환하여 시각화에 사용
```

- Convolution Layer에서 필터를 거쳐 feature map 생성
- feature map에 activation function(ReLU) 적용
- Activation Funciton이 적용된 feature map에 Pooling 적용